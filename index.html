<!doctype html>
<html>
<head>
<title>Jennie</title>
<style>
body{font-family:sans-serif;background:#111;color:#fff}
.hidden{display:none}
.card{background:#222;padding:20px;border-radius:10px;width:300px;margin:auto}
button{margin-top:10px;width:100%}
#commandsBtn{position:fixed;bottom:20px;right:20px}
#commands{position:fixed;bottom:70px;right:20px;background:#333;padding:10px;border-radius:10px}
</style>
</head>
<body>

<div id="login" class="card">
<input id="lu" placeholder="username">
<input id="lp" type="password" placeholder="password">
<button onclick="login()">Login</button>
<button onclick="register()">Register</button>
</div>

<div id="chat" class="hidden card">
<div id="role"></div>
<input id="q" placeholder="Say something">
<button onclick="send()">Send</button>
<div id="out"></div>

<div id="admin" class="hidden">
<h4>Admin Panel</h4>
<input id="makeAdminUser" placeholder="username">
<button onclick="makeAdmin()">Make Admin</button>
</div>
</div>

<button id="commandsBtn" onclick="toggle()">Commands</button>
<div id="commands" class="hidden">
<div>what is the time</div>
<div>remember something</div>
<div>open google</div>
<div>admin commands*</div>
</div>

<script>
const API="https://web-jennie.onrender.com"
let token="", role=""

async function login(){
const r=await fetch(API+"/api/login",{method:"POST",headers:{'Content-Type':'application/json'},
body:JSON.stringify({username:lu.value,password:lp.value})})
const d=await r.json()
token=d.access_token; role=d.role
loginUI()
}

async function register(){
await fetch(API+"/api/register",{method:"POST",headers:{'Content-Type':'application/json'},
body:JSON.stringify({username:lu.value,password:lp.value})})
alert("Registered")
}

function loginUI(){
login.classList.add("hidden")
chat.classList.remove("hidden")
roleDiv=document.getElementById("role")
roleDiv.innerText="Role: "+role
if(role==="master_admin") admin.classList.remove("hidden")
}

async function send(){
const r=await fetch(API+"/api/command",{method:"POST",
headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
body:JSON.stringify({query:q.value})})
out.innerText=(await r.json()).response
}

async function makeAdmin(){
await fetch(API+"/api/admin/make-admin",{method:"POST",
headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},
body:JSON.stringify({username:makeAdminUser.value})})
alert("Updated")
}

function toggle(){commands.classList.toggle("hidden")}
</script>
</body>
</html>
